(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{192:function(e,t,n){},207:function(e,t,n){"use strict";n.r(t);var a=n(71),s=n.n(a),c=n(0),r=n(29),o=n(16),i=(n(191),n(192),n(230)),l=n(240),j=n(242),b=n(236),d=n(238),u=n(174),m=n(239),O=n(99),h=n(136),p=n(101),x=n.n(p),g=n(15),v=n(22),f=n(165),y=n(3),C={user:null};if(localStorage.getItem("jwtToken")){var I=Object(f.a)(localStorage.getItem("jwtToken"));1e3*I.exp<Date.now()?localStorage.removeItem("jwtToken"):C.user=I}var w=Object(c.createContext)({user:null,login:function(e){},logout:function(){}});function k(e,t){switch(t.type){case"LOGIN":return Object(v.a)(Object(v.a)({},e),{},{user:t.payload});case"LOGOUT":return Object(v.a)(Object(v.a)({},e),{},{user:null});default:return e}}function P(e){var t=Object(c.useReducer)(k,C),n=Object(g.a)(t,2),a=n[0],s=n[1];return Object(y.jsx)(w.Provider,Object(v.a)({value:{user:a.user,login:function(e){localStorage.setItem("jwtToken",e.token),s({type:"LOGIN",payload:e})},logout:function(){localStorage.removeItem("jwtToken"),s({type:"LOGOUT"})}}},e))}var S,$=n(27),D=n(243),N=n(235);var A,L,E,R=Object(N.a)(S||(S=Object($.a)(["\n  mutation likePost($postId: ID!) {\n    likePost(postId: $postId) {\n      id\n      likes {\n        id\n        username\n      }\n      likeCount\n    }\n  }\n"]))),Q=function(e){var t=e.user,n=e.post,a=n.id,s=n.likeCount,o=n.likes,i=Object(c.useState)(!1),l=Object(g.a)(i,2),j=l[0],b=l[1];Object(c.useEffect)((function(){t&&o.find((function(e){return e.username===t.username}))?b(!0):b(!1)}),[t,o]);var d=Object(D.a)(R,{variables:{postId:a}}),u=Object(g.a)(d,1)[0],p=t?j?Object(y.jsx)(m.a,{color:"teal",children:Object(y.jsx)(O.a,{name:"heart"})}):Object(y.jsx)(m.a,{color:"teal",basic:!0,children:Object(y.jsx)(O.a,{name:"heart"})}):Object(y.jsx)(m.a,{as:r.b,to:"/login",color:"teal",basic:!0,children:Object(y.jsx)(O.a,{name:"heart"})});return Object(y.jsxs)(m.a,{as:"div",labelPosition:"right",onClick:u,children:[p,Object(y.jsx)(h.a,{basic:!0,color:"teal",pointing:"left",children:s})]})},T=n(107),q=Object(N.a)(A||(A=Object($.a)(["\n  {\n    getPosts {\n      id\n      body\n      createdAt\n      username\n      likeCount\n      likes {\n        username\n      }\n      commentCount\n      comments {\n        id\n        username\n        createdAt\n        body\n      }\n    }\n  }\n"])));var U=Object(N.a)(L||(L=Object($.a)(["\nmutation deletePost($postID:ID!){\n    deletePost(postID:$postID)\n}"]))),z=Object(N.a)(E||(E=Object($.a)(["\nmutation deleteComment($postID:ID!, $commentId:ID!){\n    deleteComment(postID:$postID, commentId: $commentId){\n        id\n        comments{\n            id username createdAt body\n        }\n        commentCount\n    }\n}"]))),G=function(e){var t=e.postId,n=e.commentId,a=e.callback,s=n?z:U,c=Object(D.a)(s,{update:function(e){if(!n){var s=e.readQuery({query:q}),c=Object(T.a)(s.getPosts);c=c.filter((function(e){return e.id!==t})),e.writeQuery({query:q,data:Object(v.a)(Object(v.a)({},s),{},{getPosts:{newData:c}})})}a&&a()},variables:{postID:t,commentId:n}}),r=Object(g.a)(c,1)[0];return Object(y.jsx)(y.Fragment,{children:Object(y.jsx)(m.a,{as:"div",color:"red",floated:"right",onClick:function(){confirm("do you want to delete this post?")?(console.log(t),r()):console.log("not deleted")},children:Object(y.jsx)(O.a,{name:"trash",style:{margin:0}})})})};var M,B=function(e){var t=e.post,n=t.body,a=t.createdAt,s=t.id,o=t.username,i=t.likeCount,l=t.commentCount,j=t.likes,b=Object(c.useContext)(w).user;return Object(y.jsxs)(d.a,{fluid:!0,children:[Object(y.jsxs)(d.a.Content,{children:[Object(y.jsx)(u.a,{floated:"right",size:"mini",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"}),Object(y.jsx)(d.a.Header,{children:o}),Object(y.jsx)(d.a.Meta,{as:r.b,to:"/posts/".concat(s),children:x()(a).fromNow(!0)}),Object(y.jsx)(d.a.Description,{children:n})]}),Object(y.jsxs)(d.a.Content,{extra:!0,children:[Object(y.jsx)(Q,{user:b,post:{id:s,likes:j,likeCount:i}}),Object(y.jsxs)(m.a,{labelPosition:"right",as:r.b,to:"/posts/".concat(s),children:[Object(y.jsx)(m.a,{color:"blue",basic:!0,children:Object(y.jsx)(O.a,{name:"comments"})}),Object(y.jsx)(h.a,{basic:!0,color:"blue",pointing:"left",children:l})]}),b&&b.username===o&&Object(y.jsx)(G,{postId:s})]})]})},H=n(232),F=n(112),J=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Object(c.useState)(t),a=Object(g.a)(n,2),s=a[0],r=a[1];function o(e){var t=e.target,n=t.value,a=t.name;r(Object(v.a)(Object(v.a)({},s),{},Object(F.a)({},a,n))),console.log(s)}var i=function(t){t.preventDefault(),e()};return{onChange:o,onSubmit:i,values:s}};function V(){var e=J((function(){r()}),{body:""}),t=e.onSubmit,n=e.onChange,a=e.values,s=Object(D.a)(W,{variables:a,update:function(e,t){var n=e.readQuery({query:q}),s=Object(T.a)(n.getPosts);s=[t.data.createPost].concat(Object(T.a)(s)),e.writeQuery({query:q,data:Object(v.a)(Object(v.a)({},n),{},{getPosts:{newData:s}})}),a.body=""}}),c=Object(g.a)(s,2),r=c[0],o=c[1].error;return Object(y.jsxs)(y.Fragment,{children:[Object(y.jsxs)(H.a,{onSubmit:t,children:[Object(y.jsx)("h2",{children:"Create a Post:"}),Object(y.jsxs)(H.a.Field,{children:[Object(y.jsx)(H.a.Input,{placeholder:"Hi World",name:"body",onChange:n,value:a.body,erro:!!o}),Object(y.jsx)(m.a,{type:"submit",color:"teal",children:"Submit"})]})]}),o&&Object(y.jsx)("div",{className:"ui error message",style:{marginBottom:20},children:Object(y.jsx)("ul",{className:"list",children:Object(y.jsx)("li",{children:o.graphQLErrors[0].message})})})]})}var W=Object(N.a)(M||(M=Object($.a)(["\nmutation createPost($body:String!){\n    createPost(body:$body){\n        id body createdAt likes{\n            id username createdAt\n        }\n        likeCount\n        comments{\n            id body username createdAt\n        }\n        commentCount\n    }\n}"])));var K,X=function(){var e=Object(c.useContext)(w).user,t=Object(l.a)(q),n=t.loading,a=t.data;return Object(y.jsx)("div",{children:Object(y.jsxs)(j.a,{columns:3,children:[Object(y.jsx)(j.a.Row,{className:"page-title",children:Object(y.jsx)("h1",{children:"Recent Post"})}),e&&Object(y.jsx)(j.a.Column,{children:Object(y.jsx)(V,{})}),Object(y.jsx)(j.a.Row,{children:n?Object(y.jsx)("h1",{children:"Loading post..."}):Object(y.jsx)(b.a.Group,{children:a.getPosts&&a.getPosts.map((function(e){return Object(y.jsx)(j.a.Column,{children:Object(y.jsx)(B,{post:e})},e.id)}))})})]})})};var Y,Z=Object(N.a)(K||(K=Object($.a)(["\nmutation register($username:String!\n$email:String!\n$password:String!\n$confirmPassword:String!){\n    register(\n        registerInput:{\n        username:$username\n        email:$email\n        password:$password\n        confirmPassword:$confirmPassword\n        }\n    ){\n        id email username createdAt token\n    }\n}\n"]))),_=Object(o.f)((function(e){var t=e.history,n=Object(c.useState)(""),a=Object(g.a)(n,2),s=a[0],r=a[1],o=(Object(c.useContext)(w),J((function(){u()}),{username:"",email:"",password:"",confirmPassword:""})),i=o.onChange,l=o.onSubmit,j=o.values,b=Object(D.a)(Z,{update:function(e,n){var a=n.data.register;console.log(a),t.push("/")},onError:function(e){r(e.graphQLErrors[0].extensions.errors),console.log(e.graphQLErrors[0].extensions.errors)},variables:j}),d=Object(g.a)(b,2),u=d[0],O=d[1].loading;return Object(y.jsxs)("div",{className:"form-container",children:[Object(y.jsxs)(H.a,{onSubmit:l,noValidate:!0,className:O?"loading":"",children:[Object(y.jsx)("h1",{children:"Register"}),Object(y.jsx)(H.a.Input,{label:"Username",placeholder:"Username",name:"username",error:!!s.username,value:j.username,onChange:i,type:"text"}),Object(y.jsx)(H.a.Input,{label:"E-mail",placeholder:"E-mail",value:j.email,error:!!s.email,onChange:i,name:"email",type:"text"}),Object(y.jsx)(H.a.Input,{label:"Password",placeholder:"Password",name:"password",error:!!s.password,onChange:i,value:j.password,type:"password"}),Object(y.jsx)(H.a.Input,{label:"Confirm Password",placeholder:"confirm-password",error:!!s.confirmPassword,onChange:i,value:j.confirmPassword,name:"confirmPassword",type:"password"}),Object(y.jsx)(m.a,{type:"submit",primary:!0,children:"Register"})]}),Object.keys(s).length>0&&Object(y.jsx)("div",{className:"ui error message",children:Object(y.jsx)("ul",{className:"list",children:Object.values(s).map((function(e){return Object(y.jsx)("li",{children:e},e)}))})})]})}));var ee=Object(N.a)(Y||(Y=Object($.a)(["\n  mutation login($username:String!, $password:String!) {\n    login(username:$username, password:$password) {\n      username\n      token\n    }\n  }\n"]))),te=Object(o.f)((function(e){var t=e.history,n=Object(c.useContext)(w),a=Object(c.useState)({}),s=Object(g.a)(a,2),r=s[0],o=s[1],i=J((function(){O()}),{username:"",password:""}),l=i.onChange,j=i.onSubmit,b=i.values,d=Object(D.a)(ee,{update:function(e,a){var s=a.data.login;n.login(s),t.push("/")},onError:function(e){o(e.graphQLErrors[0].extensions.errors)},variables:b}),u=Object(g.a)(d,2),O=u[0],h=u[1].loading;return Object(y.jsxs)("div",{className:"form-container",children:[Object(y.jsxs)(H.a,{onSubmit:j,noValidate:!0,className:h?"loading":"",children:[Object(y.jsx)("h1",{children:"Register"}),Object(y.jsx)(H.a.Input,{label:"Username",placeholder:"Username",name:"username",error:!!r.username,value:b.username,onChange:l,type:"text"}),Object(y.jsx)(H.a.Input,{label:"Password",placeholder:"Password",name:"password",error:!!r.password,onChange:l,value:b.password,type:"password"}),Object(y.jsx)(m.a,{type:"submit",primary:!0,children:"Login"})]}),Object.keys(r).length>0&&Object(y.jsx)("div",{className:"ui error message",children:Object(y.jsx)("ul",{className:"list",children:Object.values(r).map((function(e){return Object(y.jsx)("li",{children:e},e)}))})})]})})),ne=n(233);function ae(){var e=Object(c.useContext)(w),t=e.logout,n=e.user,a=window.location.pathname,s="/"===a?"home":a.substr(1),o=Object(c.useState)(s),i=Object(g.a)(o,2),l=i[0],j=i[1],b=function(e,t){var n=t.name;return j(n)};return n?Object(y.jsx)("div",{style:{marginBottom:10},children:Object(y.jsxs)(ne.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(y.jsx)(ne.a.Item,{name:n.username,active:!0,as:r.b,to:"/"}),Object(y.jsx)(ne.a.Menu,{position:"right",children:Object(y.jsx)(ne.a.Item,{name:"logout",onClick:t})})]})}):Object(y.jsx)("div",{children:Object(y.jsxs)(ne.a,{pointing:!0,secondary:!0,size:"massive",color:"teal",children:[Object(y.jsx)(ne.a.Item,{name:"home",active:"home"===l,onClick:b,as:r.b,to:"/"}),Object(y.jsxs)(ne.a.Menu,{position:"right",children:[Object(y.jsx)(ne.a.Item,{name:"login",active:"login"===l,onClick:b,as:r.b,to:"/login"}),Object(y.jsx)(ne.a.Item,{name:"register",active:"register"===l,onClick:b,as:r.b,to:"/register"})]})]})})}var se=n(171),ce=["component"];var re,oe,ie=function(e){var t=e.component,n=Object(se.a)(e,ce),a=Object(c.useContext)(w).user;return Object(y.jsx)(o.b,Object(v.a)(Object(v.a)({},n),{},{render:function(e){return a?Object(y.jsx)(o.a,{to:"/"}):Object(y.jsx)(t,Object(v.a)({},e))}}))};function le(e){var t=e.match.params.postId;console.log(t);var n,a=Object(c.useContext)(w).user,s=Object(c.useRef)(null),r=Object(c.useState)(""),o=Object(g.a)(r,2),i=o[0],b=o[1],p=Object(l.a)(je,{variables:{postId:t}}),v=p.data,f=p.loading,C=Object(D.a)(be,{update:function(){b(""),s.current.blur()},variables:{postId:t,body:i}}),I=Object(g.a)(C,1)[0];if(f)n=Object(y.jsx)("p",{children:"Loading Post..."});else{var k=v.getPost,P=k.id,S=k.body,$=k.createdAt,N=k.username,A=k.comments,L=k.likes,E=k.likeCount,R=k.commentCount;n=Object(y.jsx)(j.a,{children:Object(y.jsxs)(j.a.Row,{children:[Object(y.jsx)(j.a.Column,{width:2,children:Object(y.jsx)(u.a,{floated:"right",size:"small",src:"https://react.semantic-ui.com/images/avatar/large/molly.png"})}),Object(y.jsxs)(j.a.Column,{width:10,children:[Object(y.jsxs)(d.a,{fluid:!0,children:[Object(y.jsxs)(d.a.Content,{children:[Object(y.jsx)(d.a.Header,{children:N}),Object(y.jsx)(d.a.Meta,{children:x()($).fromNow()}),Object(y.jsx)(d.a.Description,{children:S})]}),Object(y.jsx)("hr",{}),Object(y.jsxs)(d.a.Content,{extra:!0,children:[Object(y.jsx)(Q,{user:a,post:{id:P,likeCount:E,likes:L}}),Object(y.jsxs)(m.a,{labelPosition:"right",as:"div",onClick:function(){return console.log("comment")},children:[Object(y.jsx)(m.a,{color:"blue",basic:!0,children:Object(y.jsx)(O.a,{name:"comments"})}),Object(y.jsx)(h.a,{basic:!0,color:"blue",pointing:"left",children:R})]}),a&&a.username===N&&Object(y.jsx)(G,{postId:P,callback:function(){e.history.push("/")}})]})]}),a&&Object(y.jsx)(d.a,{fluid:!0,children:Object(y.jsxs)(d.a.Content,{children:[Object(y.jsx)("p",{children:"Post a Comment"}),Object(y.jsx)(H.a,{children:Object(y.jsxs)("div",{className:"ui action input fluid",children:[Object(y.jsx)("input",{type:"text",placeholder:"comment...",name:"comment",value:i,onChange:function(e){return b(e.target.value)},ref:s}),Object(y.jsx)("button",{type:"submit",class:"ui button teal",disabled:""===i.trim(),onClick:I,children:"Submit"})]})})]})}),A.map((function(e){return Object(y.jsx)(d.a,{fluid:!0,children:Object(y.jsxs)(d.a.Content,{children:[a&&a.username===e.username&&Object(y.jsx)(G,{postId:P,commentId:e.id}),Object(y.jsx)(d.a.Header,{children:e.username}),Object(y.jsx)(d.a.Meta,{children:x()(e.createdAt).fromNow()}),Object(y.jsx)(d.a.Description,{children:e.body})]})},e.id)}))]})]})})}return n}var je=Object(N.a)(re||(re=Object($.a)(["query getPost($postId:ID!){\n    getPost(postID:$postId){\n        id\n        body\n        createdAt username likeCount likes{\n            username\n        }\n        commentCount\n        comments{\n            id\n            username\n            createdAt\n            body\n        }\n    }\n}"]))),be=Object(N.a)(oe||(oe=Object($.a)(["\nmutation($postId:ID!, $body:String!){\n    createComment(postId:$postId, body:$body){\n        id\n        comments{\n            id\n            body\n            createdAt \n            username\n        }\n        commentCount\n    }\n}\n"])));var de=function(){return Object(y.jsx)(P,{children:Object(y.jsx)(r.a,{children:Object(y.jsxs)(i.a,{children:[Object(y.jsx)(ae,{}),Object(y.jsx)(o.b,{exact:!0,path:"/",children:Object(y.jsx)(X,{})}),Object(y.jsx)(ie,{exact:!0,path:"/login",component:te}),Object(y.jsx)(ie,{exact:!0,path:"/register",component:_}),Object(y.jsx)(o.b,{exact:!0,path:"/posts/:postId",component:le})]})})})},ue=n(173),me=n(234),Oe=n(237),he=n(231),pe=n(172),xe=Object(ue.a)({uri:"https://aqueous-dawn-89020.herokuapp.com/"}),ge=Object(pe.a)((function(){var e=localStorage.getItem("jwtToken");return{headers:{Authorization:e?"Bearer ".concat(e):""}}})),ve=new me.a({link:ge.concat(xe),cache:new Oe.a}),fe=Object(y.jsx)(he.a,{client:ve,children:Object(y.jsx)(de,{})});s.a.render(fe,document.getElementById("root"))}},[[207,1,2]]]);
//# sourceMappingURL=main.dafcbcb6.chunk.js.map